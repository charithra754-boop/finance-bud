# ================================================================================
# FinPilot VP-MAS Environment Configuration
# ================================================================================
# Copy this file to .env and update values as needed
#
# PRODUCTION CHECKLIST:
# - Set ENVIRONMENT=production
# - Generate strong JWT_SECRET_KEY (32+ characters)
# - Configure DATABASE_URL
# - Configure REDIS_URL
# - Set production CORS_ORIGINS (no localhost)
# - Enable authentication and rate limiting
# - Configure monitoring (Sentry, Prometheus)
# - Never commit .env file to version control!
# ================================================================================

# ================================================================================
# ENVIRONMENT
# ================================================================================
# Options: development, staging, production
# This affects validation rules and feature flags
ENVIRONMENT=development

# ================================================================================
# API Server Configuration
# ================================================================================
API_HOST=0.0.0.0
API_PORT=8000
API_TITLE="FinPilot VP-MAS API"
API_VERSION=1.0.0
API_DESCRIPTION="Verifiable Planning Multi-Agent System for Financial Planning"
RELOAD=true
LOG_LEVEL=info

# ================================================================================
# CORS Configuration
# ================================================================================
# Development: Allow localhost origins
# Production: Set to your actual domain(s), NO localhost/wildcards
CORS_ORIGINS=["http://localhost:3000","http://localhost:5173"]
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_METHODS=["*"]
CORS_ALLOW_HEADERS=["*"]

# ================================================================================
# Agent Configuration
# ================================================================================
# PRODUCTION DEFAULT: Real agents enabled (mocks disabled)
# Set to true ONLY for local development/testing
USE_MOCK_ORCHESTRATION=false
USE_MOCK_PLANNING=false
USE_MOCK_RETRIEVAL=false
USE_REAL_VERIFICATION=true
CONVERSATIONAL_AGENT_ENABLED=true

# ================================================================================
# External API Configuration
# ================================================================================
# Alpha Vantage: Get free API key at https://www.alphavantage.co/support/#api-key
# Free tier: 5 requests/minute, 500 requests/day
ALPHA_VANTAGE_API_KEY=

# Yahoo Finance: Uses yfinance library (no key required)
YAHOO_FINANCE_ENABLED=true

# Optional: Additional data providers
# BARCHART_API_KEY=
# IEX_CLOUD_API_KEY=
# POLYGON_API_KEY=

# ================================================================================
# Ollama Configuration (Conversational Agent LLM)
# ================================================================================
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_MODEL=llama2
OLLAMA_TIMEOUT=30

# ================================================================================
# Database Configuration (PostgreSQL)
# ================================================================================
# Format: postgresql://user:password@host:port/database
# Example: postgresql://finpilot:securepass@localhost:5432/finpilot
# Production: Use connection pooler (PgBouncer) or managed database (RDS, Supabase)
DATABASE_URL=

# Connection Pooling
DATABASE_POOL_SIZE=5
DATABASE_MAX_OVERFLOW=10
DATABASE_POOL_PRE_PING=true
DATABASE_POOL_RECYCLE=3600
DATABASE_ECHO=false

# Supabase (Alternative to self-hosted PostgreSQL)
# SUPABASE_URL=
# SUPABASE_KEY=

# ================================================================================
# Redis Configuration (Caching & Rate Limiting)
# ================================================================================
# Format: redis://host:port/db or redis://user:password@host:port/db
# Example: redis://localhost:6379/0
# Production: Use Redis Cluster or managed service (ElastiCache, Memorystore)
REDIS_URL=

REDIS_MAX_CONNECTIONS=50
REDIS_DECODE_RESPONSES=true
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5

# ================================================================================
# Performance & Caching
# ================================================================================
CACHE_ENABLED=true
CACHE_TTL_SECONDS=300
MAX_REQUEST_TIMEOUT=120

# ================================================================================
# Security - Authentication & Authorization
# ================================================================================

# JWT Authentication (REQUIRED for production)
# Generate strong secret: python -c "import secrets; print(secrets.token_urlsafe(32))"
# CRITICAL: Never commit actual secrets to git!
JWT_SECRET_KEY=

JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=15
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# Legacy API Key Auth (use JWT instead)
ENABLE_API_KEY_AUTH=false
API_KEY=

# Rate Limiting (ENABLE IN PRODUCTION)
RATE_LIMIT_ENABLED=false
RATE_LIMIT_REQUESTS_PER_MINUTE=60
RATE_LIMIT_BURST_MULTIPLIER=1.5

# Security Headers & Protection (ENABLE IN PRODUCTION)
ENABLE_HTTPS_REDIRECT=false
ENABLE_CSRF_PROTECTION=true
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=lax

# ================================================================================
# Agent Timeouts (seconds)
# ================================================================================
# Centralized timeout configuration for all agent operations
AGENT_ORCHESTRATION_TIMEOUT=60
AGENT_PLANNING_TIMEOUT=300
AGENT_VERIFICATION_TIMEOUT=30
AGENT_EXECUTION_TIMEOUT=120
AGENT_RETRIEVAL_TIMEOUT=30
AGENT_CONVERSATIONAL_TIMEOUT=30

# ================================================================================
# Background Task Intervals (seconds)
# ================================================================================
# How often background tasks run
HEALTH_CHECK_INTERVAL_SECONDS=30
CLEANUP_INTERVAL_SECONDS=3600
MONITORING_INTERVAL_SECONDS=60
TRIGGER_CHECK_INTERVAL_SECONDS=300

# ================================================================================
# Monitoring & Observability
# ================================================================================

# Enable/Disable monitoring features
MONITORING_ENABLED=false
PROMETHEUS_ENABLED=false
PROMETHEUS_PORT=9090

# Sentry Error Tracking
# Get DSN from https://sentry.io/
SENTRY_DSN=
SENTRY_ENVIRONMENT=development
SENTRY_TRACES_SAMPLE_RATE=0.1

# Distributed Tracing (OpenTelemetry)
TRACING_ENABLED=false
TRACING_ENDPOINT=

# ================================================================================
# Logging Configuration
# ================================================================================
# Path to log file (leave empty for stdout only)
LOG_FILE_PATH=

# Log rotation and retention
LOG_ROTATION_SIZE_MB=100
LOG_RETENTION_DAYS=30

# Log format: json (structured) or text (human-readable)
LOG_FORMAT=json
LOG_INCLUDE_CORRELATION_ID=true

# ================================================================================
# Secrets Management (Optional)
# ================================================================================
# Use external secrets manager instead of environment variables
# Options: env, aws, vault, azure, gcp
USE_SECRETS_MANAGER=false
SECRETS_MANAGER_TYPE=env
SECRETS_MANAGER_PATH=

# ================================================================================
# Development & Debug
# ================================================================================
# NEVER enable in production
DEBUG_MODE=false
ENABLE_PROFILING=false

# ================================================================================
# PRODUCTION DEPLOYMENT NOTES
# ================================================================================
#
# 1. REQUIRED for Production:
#    - ENVIRONMENT=production
#    - JWT_SECRET_KEY (32+ chars, cryptographically random)
#    - DATABASE_URL (PostgreSQL connection string)
#    - REDIS_URL (Redis connection string)
#    - CORS_ORIGINS (your actual domain, no localhost)
#    - SENTRY_DSN (error tracking)
#
# 2. MUST ENABLE in Production:
#    - RATE_LIMIT_ENABLED=true
#    - ENABLE_HTTPS_REDIRECT=true
#    - MONITORING_ENABLED=true
#    - PROMETHEUS_ENABLED=true
#
# 3. Production Defaults (already set correctly):
#    ✅ USE_MOCK_ORCHESTRATION=false (real agents enabled)
#    ✅ USE_MOCK_PLANNING=false (real agents enabled)
#    ✅ USE_MOCK_RETRIEVAL=false (real agents enabled)
#    - DEBUG_MODE=false (must keep false)
#    - RELOAD=false (must set false for production)
#
# 4. Security Checklist:
#    - All secrets in secrets manager or encrypted
#    - No localhost in CORS_ORIGINS
#    - HTTPS only (no HTTP)
#    - Security headers enabled
#    - Rate limiting active
#    - Database backups automated
#    - Monitoring and alerting configured
#
# 5. Database Setup:
#    - Run migrations: alembic upgrade head
#    - Create database backups
#    - Configure connection pooling
#    - Set up read replicas (if needed)
#
# 6. Redis Setup:
#    - Use Redis Cluster for HA
#    - Configure persistence (AOF/RDB)
#    - Set up monitoring
#
# 7. Monitoring:
#    - Configure Prometheus scraping
#    - Set up Grafana dashboards
#    - Configure alerting rules
#    - Set up Sentry projects
#
# ================================================================================
